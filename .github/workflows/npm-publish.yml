name: Release
on:
  push:
    branches:
      - main # åªæœ‰åˆå¹¶åˆ° main æ—¶è§¦å‘

permissions:
  contents: write # èµ‹äºˆå†™æƒé™ï¼Œä»¥ä¾¿æŠŠç‰ˆæœ¬å·æ¨å›ä»“åº“
  issues: write
  pull-requests: write

jobs:
  release:
    name: Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0 # è·å–æ‰€æœ‰å†å²è®°å½•ï¼Œä»¥ä¾¿åˆ†æ commit

        # 1. é…ç½® pnpm (æ¨èå›ºå®šç‰ˆæœ¬)
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10.24.0 # æˆ–è€…æŒ‡å®šå…·ä½“ç‰ˆæœ¬ï¼Œå¦‚ 9.1.0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "lts/*"
          registry-url: "https://registry.npmjs.org/"
          cache: "pnpm" # ğŸ”¥ å¼€å¯ pnpm ç¼“å­˜ï¼Œç¬¬äºŒæ¬¡æ„å»ºé€Ÿåº¦ä¼šé£å¿«

      - name: Install dependencies
        run: pnpm install

      - name: Build
        run: pnpm run build # å¦‚æœä½ æœ‰ build è„šæœ¬ï¼Œå¿…é¡»å…ˆæ„å»º

      - name: Semantic Release
        env:
          # å¿…é¡»ä¼ å…¥è¿™ä¸¤ä¸ª Token
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # GitHub è‡ªåŠ¨ç”Ÿæˆçš„
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }} # ä½ åˆšæ‰é…ç½®çš„ Secret
        run: npx semantic-release
