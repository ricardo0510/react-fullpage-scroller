name: Release
on:
  push:
    branches:
      - master # 只有合并到 master 时触发

permissions:
  contents: write # 赋予写权限，以便把版本号推回仓库
  issues: write
  pull-requests: write

jobs:
  release:
    name: Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 获取所有历史记录，以便分析 commit

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "lts/*"
          registry-url: "https://registry.npmjs.org/"

      - name: Install dependencies
        run: npm install

      - name: Build
        run: npm run build # 如果你有 build 脚本，必须先构建

      - name: Semantic Release
        env:
          # 必须传入这两个 Token
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # GitHub 自动生成的
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }} # 你刚才配置的 Secret
        run: npx semantic-release
